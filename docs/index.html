<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF2QUIZ - 題庫練習系統</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Google Fonts - Noto Sans TC -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- 頂部導航 -->
        <header class="sidebar">
            <div class="sidebar-header">
                <i data-lucide="book-open" class="header-icon"></i>
                <h1>PDF2QUIZ</h1>
            </div>
            <nav class="sidebar-nav">
                <button id="nav-home" class="nav-btn active">
                    <i data-lucide="home"></i>
                    <span>首頁</span>
                </button>
                <button id="nav-quiz" class="nav-btn" disabled>
                    <i data-lucide="edit-3"></i>
                    <span>測驗中</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <div class="quiz-bank-info">
                    <i data-lucide="database"></i>
                    <span id="current-bank" class="value">-</span>
                </div>
            </div>
        </header>

        <!-- 主要內容區 -->
        <main class="main-content">
            <!-- 首頁 -->
            <section id="home-screen" class="screen">
                <div class="screen-header">
                    <h2>選擇題庫開始練習</h2>
                </div>

                <div class="bank-selector">
                    <div class="bank-list" id="bank-list">
                        <!-- 題庫列表動態載入 -->
                    </div>

                    <!-- 工具列：上傳 + 搜尋 + 格式說明 -->
                    <div class="toolbar-section">
                        <label class="upload-btn-compact">
                            <input type="file" id="file-input" accept=".jsonl" hidden>
                            <i data-lucide="upload"></i>
                            <span>上傳題庫</span>
                        </label>
                        <div class="search-box-compact">
                            <i data-lucide="search"></i>
                            <input type="text" id="search-id-input" placeholder="ID 或 topic.id" title="輸入題目 ID，或 topic.id 格式（如：3.15）">
                            <button id="btn-search-id" class="btn-search-compact">
                                <i data-lucide="arrow-right"></i>
                            </button>
                        </div>
                        <button id="btn-show-format" class="format-help-btn-compact" title="查看 JSONL 格式範例">
                            <i data-lucide="help-circle"></i>
                        </button>
                    </div>

                    <!-- JSONL 格式說明 Modal -->
                    <div id="format-modal" class="modal hidden">
                        <div class="modal-overlay"></div>
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>JSONL 題庫格式說明</h3>
                                <button id="btn-close-modal" class="modal-close">
                                    <i data-lucide="x"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p class="format-desc">每行一個 JSON 物件，格式如下：</p>
                                <pre class="format-example">{
  "id": 1,
  "topic": 1,
  "question": "Which of the following tools can be used for passive OS fingerprinting?",
  "options": {
    "A": "nmap",
    "B": "tcpdump",
    "C": "tracert",
    "D": "ping"
  },
  "answer": ["B"],
  "explanation": "tcpdump captures network traffic passively..."
}</pre>
                                <div class="format-fields">
                                    <h4>欄位說明：</h4>
                                    <ul>
                                        <li><code>id</code> - 題目編號（數字）</li>
                                        <li><code>topic</code> - 主題編號（數字，可選）</li>
                                        <li><code>question</code> - 題目內容（字串，必填）</li>
                                        <li><code>options</code> - 選項物件（必填，A/B/C/D...）</li>
                                        <li><code>answer</code> - 正確答案陣列（必填，如 ["A"] 或 ["A","C"]）</li>
                                        <li><code>explanation</code> - 解釋說明（字串，可選）</li>
                                    </ul>
                                </div>
                                <div class="format-note">
                                    <i data-lucide="info"></i>
                                    <span>上傳的題庫會儲存在瀏覽器本地，下次開啟時會自動載入。</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="quiz-setup" class="quiz-setup hidden">
                    <!-- 標題和練習統計合併 -->
                    <div class="setup-header-row">
                        <div class="setup-header">
                            <h3 id="selected-bank-name">-</h3>
                            <p id="selected-bank-count">共 0 題</p>
                        </div>
                        <div id="practice-stats" class="practice-stats-compact hidden">
                            <div class="stat-badge">
                                <i data-lucide="check-circle"></i>
                                <span>已練習 <strong id="stat-practiced">0</strong></span>
                            </div>
                            <div class="stat-badge wrong">
                                <i data-lucide="x-circle"></i>
                                <span>錯題 <strong id="stat-wrong-count">0</strong></span>
                            </div>
                        </div>
                    </div>

                    <!-- 錯題練習按鈕 -->
                    <div id="wrong-practice-section" class="wrong-practice-section hidden">
                        <button id="btn-practice-wrong" class="btn-practice-wrong" disabled>
                            <i data-lucide="repeat"></i>
                            <span>練習錯題</span>
                        </button>
                        <button id="btn-clear-history" class="btn-clear-history" title="清除練習記錄">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>

                    <!-- 題數選擇和選項設定合併為一行 -->
                    <div class="quiz-options-row">
                        <div class="mode-selector-compact">
                            <label class="mode-chip">
                                <input type="radio" name="mode" value="all" checked>
                                <span>全部</span>
                            </label>
                            <label class="mode-chip">
                                <input type="radio" name="mode" value="50">
                                <span>50 題</span>
                            </label>
                            <label class="mode-chip has-input">
                                <input type="radio" name="mode" value="custom">
                                <input type="number" id="custom-count" class="custom-input-compact" min="1" max="999" value="30" disabled>
                                <span>題</span>
                            </label>
                        </div>
                        <div class="option-toggles-compact">
                            <label class="toggle-chip" title="打亂題目順序">
                                <input type="checkbox" id="shuffle-questions" checked>
                                <span>亂序題目</span>
                            </label>
                            <label class="toggle-chip" title="打亂選項順序">
                                <input type="checkbox" id="shuffle-options" checked>
                                <span>亂序選項</span>
                            </label>
                        </div>
                    </div>

                    <button id="btn-start" class="btn-start">
                        <i data-lucide="play"></i>
                        <span>開始測驗</span>
                    </button>
                </div>
            </section>

            <!-- 測驗畫面 -->
            <section id="quiz-screen" class="screen hidden">
                <div class="quiz-header">
                    <div class="progress-info">
                        <span id="progress-text">1 / 50</span>
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                    </div>
                    <button id="btn-end-quiz" class="btn-end">
                        <i data-lucide="x"></i>
                        <span>結束測驗</span>
                    </button>
                </div>

                <div class="question-container">
                    <div class="question-meta">
                        <span id="question-id" class="q-id hidden"></span>
                        <span id="question-type" class="q-type"></span>
                        <div id="question-history" class="q-history hidden"></div>
                        <button id="btn-toggle-translate" class="translate-toggle" title="切換翻譯">
                            <i data-lucide="languages"></i>
                            <span>翻譯</span>
                        </button>
                    </div>
                    <div id="question-text" class="question-text bilingual">
                        <div class="text-original"></div>
                        <div class="text-translated hidden"></div>
                    </div>

                    <div id="options-container" class="options-container"></div>

                    <div id="feedback" class="feedback hidden">
                        <div id="feedback-icon" class="feedback-icon"></div>
                        <div class="feedback-content">
                            <div id="feedback-message" class="feedback-message"></div>
                            <div id="correct-answer" class="correct-answer"></div>
                        </div>
                    </div>

                    <div id="explanation" class="explanation hidden"></div>
                </div>

                <div class="quiz-footer">
                    <button id="btn-prev" class="btn-nav" disabled>
                        <i data-lucide="chevron-left"></i>
                        <span>上一題</span>
                    </button>
                    <button id="btn-submit" class="btn-submit">
                        <i data-lucide="check"></i>
                        <span>確認答案</span>
                    </button>
                    <button id="btn-next" class="btn-nav hidden">
                        <span>下一題</span>
                        <i data-lucide="chevron-right"></i>
                    </button>
                </div>
            </section>

            <!-- 結果畫面 -->
            <section id="result-screen" class="screen hidden">
                <div class="result-container">
                    <h2>測驗結果</h2>

                    <div class="score-display">
                        <div class="score-ring">
                            <svg viewBox="0 0 100 100">
                                <circle class="ring-bg" cx="50" cy="50" r="45"></circle>
                                <circle id="score-ring" class="ring-progress" cx="50" cy="50" r="45"></circle>
                            </svg>
                            <div class="score-text">
                                <span id="score-percent">0</span>%
                            </div>
                        </div>
                    </div>

                    <div class="score-stats">
                        <div class="stat correct">
                            <i data-lucide="check-circle"></i>
                            <span class="stat-value" id="stat-correct">0</span>
                            <span class="stat-label">答對</span>
                        </div>
                        <div class="stat incorrect">
                            <i data-lucide="x-circle"></i>
                            <span class="stat-value" id="stat-incorrect">0</span>
                            <span class="stat-label">答錯</span>
                        </div>
                        <div class="stat total">
                            <i data-lucide="list"></i>
                            <span class="stat-value" id="stat-total">0</span>
                            <span class="stat-label">總題數</span>
                        </div>
                    </div>

                    <div class="result-actions">
                        <button id="btn-review" class="btn-secondary">
                            <i data-lucide="eye"></i>
                            <span>查看錯題</span>
                        </button>
                        <button id="btn-retry" class="btn-secondary">
                            <i data-lucide="rotate-ccw"></i>
                            <span>重新測驗</span>
                        </button>
                        <button id="btn-home" class="btn-primary">
                            <i data-lucide="home"></i>
                            <span>返回首頁</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 錯題回顧 -->
            <section id="review-screen" class="screen hidden">
                <div class="review-header">
                    <h2>錯題回顧</h2>
                    <button id="btn-back-result" class="btn-secondary">
                        <i data-lucide="arrow-left"></i>
                        <span>返回結果</span>
                    </button>
                </div>
                <div id="review-list" class="review-list"></div>
            </section>

            <!-- 單題查看 -->
            <section id="view-screen" class="screen hidden">
                <div class="view-screen-header">
                    <h2>題目詳情</h2>
                    <button id="btn-back-home" class="btn-secondary">
                        <i data-lucide="arrow-left"></i>
                        <span>返回首頁</span>
                    </button>
                </div>
                <div id="view-question" class="view-question-container">
                    <!-- 動態載入 -->
                </div>
            </section>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
